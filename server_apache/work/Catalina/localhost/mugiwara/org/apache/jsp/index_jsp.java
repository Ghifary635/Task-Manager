/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: Apache Tomcat/9.0.104
 * Generated at: 2025-12-18 07:54:30 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;
import java.util.ArrayList;
import Models.Book;
import Models.Review;
import Models.BannerSlide;
import java.text.NumberFormat;
import java.util.Locale;

public final class index_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent,
                 org.apache.jasper.runtime.JspSourceImports {

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  static {
    _jspx_dependants = new java.util.HashMap<java.lang.String,java.lang.Long>(1);
    _jspx_dependants.put("/session.jsp", Long.valueOf(1750127333800L));
  }

  private static final java.util.Set<java.lang.String> _jspx_imports_packages;

  private static final java.util.Set<java.lang.String> _jspx_imports_classes;

  static {
    _jspx_imports_packages = new java.util.LinkedHashSet<>(4);
    _jspx_imports_packages.add("javax.servlet");
    _jspx_imports_packages.add("javax.servlet.http");
    _jspx_imports_packages.add("javax.servlet.jsp");
    _jspx_imports_classes = new java.util.LinkedHashSet<>(8);
    _jspx_imports_classes.add("Models.BannerSlide");
    _jspx_imports_classes.add("java.util.Locale");
    _jspx_imports_classes.add("Models.Book");
    _jspx_imports_classes.add("Models.Review");
    _jspx_imports_classes.add("java.text.NumberFormat");
    _jspx_imports_classes.add("java.util.ArrayList");
  }

  private volatile javax.el.ExpressionFactory _el_expressionfactory;
  private volatile org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public java.util.Set<java.lang.String> getPackageImports() {
    return _jspx_imports_packages;
  }

  public java.util.Set<java.lang.String> getClassImports() {
    return _jspx_imports_classes;
  }

  public javax.el.ExpressionFactory _jsp_getExpressionFactory() {
    if (_el_expressionfactory == null) {
      synchronized (this) {
        if (_el_expressionfactory == null) {
          _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
        }
      }
    }
    return _el_expressionfactory;
  }

  public org.apache.tomcat.InstanceManager _jsp_getInstanceManager() {
    if (_jsp_instancemanager == null) {
      synchronized (this) {
        if (_jsp_instancemanager == null) {
          _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
        }
      }
    }
    return _jsp_instancemanager;
  }

  public void _jspInit() {
  }

  public void _jspDestroy() {
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
      throws java.io.IOException, javax.servlet.ServletException {

    if (!javax.servlet.DispatcherType.ERROR.equals(request.getDispatcherType())) {
      final java.lang.String _jspx_method = request.getMethod();
      if ("OPTIONS".equals(_jspx_method)) {
        response.setHeader("Allow","GET, HEAD, POST, OPTIONS");
        return;
      }
      if (!"GET".equals(_jspx_method) && !"POST".equals(_jspx_method) && !"HEAD".equals(_jspx_method)) {
        response.setHeader("Allow","GET, HEAD, POST, OPTIONS");
        response.sendError(HttpServletResponse.SC_METHOD_NOT_ALLOWED, "JSPs only permit GET, POST or HEAD. Jasper also permits OPTIONS");
        return;
      }
    }

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html;charset=UTF-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");

    boolean isLoggedIn = (session != null && session.getAttribute("isLoggedIn") != null) ?
                         ((Boolean) session.getAttribute("isLoggedIn")).booleanValue() : false;

    if (isLoggedIn == false || !isLoggedIn) {
        response.sendRedirect("login.jsp?message=not_logged_in");
        return;
    }
    
    int userId = (session.getAttribute("user_id") != null) ? (Integer) session.getAttribute("user_id") : 0; // Default ID, e.g., 0 or -1
    String username = (session.getAttribute("username") != null) ? (String) session.getAttribute("username") : "Guest";
    String email = (session.getAttribute("email") != null) ? (String) session.getAttribute("email") : "guest@example.com";
    String fullName = (session.getAttribute("full_name") != null) ? (String) session.getAttribute("full_name") : "Pengguna Tidak Dikenal";
    int roleId = (session.getAttribute("role_id") != null) ? (Integer) session.getAttribute("role_id") : 0; // Default role ID, e.g., 0 for unknown
    String roleName = (session.getAttribute("role_name") != null) ? (String) session.getAttribute("role_name") : "Guest";

      out.write(' ');
      out.write("\r\n");
      out.write("<!DOCTYPE html>\r\n");
      out.write("<html lang=\"en\">\r\n");
      out.write("<head>\r\n");
      out.write("    <meta charset=\"UTF-8\">\r\n");
      out.write("    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n");
      out.write("    <title>Mugiwara Library</title>\r\n");
      out.write("    <link href=\"https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap\" rel=\"stylesheet\" />\r\n");
      out.write("    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css\" rel=\"stylesheet\" />\r\n");
      out.write("    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css\" rel=\"stylesheet\" />\r\n");
      out.write("    <link rel=\"shortcut icon\" type=\"x-icon\" href=\"assets/images/Logo Store.png\">\r\n");
      out.write("    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js\"></script>\r\n");
      out.write("    <link rel=\"stylesheet\" href=\"assets/css/style.css\">\r\n");
      out.write("</head>\r\n");
      out.write("<body>\r\n");

    // Get data from servlet with null checks (logika dari old)
    ArrayList<Book> latestBooks = (ArrayList<Book>) request.getAttribute("latestBooks");
    ArrayList<Book> bestSellingBooks = (ArrayList<Book>) request.getAttribute("bestSellingBooks");
    ArrayList<Review> customerReviews = (ArrayList<Review>) request.getAttribute("customerReviews");
    ArrayList<BannerSlide> activeBanners = (ArrayList<BannerSlide>) request.getAttribute("activeBanners");
    
    // Initialize if null (logika dari old)
    if (latestBooks == null) latestBooks = new ArrayList<>();
    if (bestSellingBooks == null) bestSellingBooks = new ArrayList<>();
    if (customerReviews == null) customerReviews = new ArrayList<>();
    if (activeBanners == null) activeBanners = new ArrayList<>();
    
    // Number formatter for currency (logika dari old)
    NumberFormat currencyFormat = NumberFormat.getCurrencyInstance(new Locale("id", "ID"));

      out.write("\r\n");
      out.write("\r\n");
      out.write("<!-- Header -->\r\n");
      out.write("<header>\r\n");
      out.write("    <nav>\r\n");
      out.write("        <div class=\"logo-container\">\r\n");
      out.write("            <a href=\"home\">\r\n");
      out.write("                <img src=\"assets/images/Logo Store.png\" alt=\"logo\" class=\"logo_home\"> \r\n");
      out.write("            </a>\r\n");
      out.write("        </div>\r\n");
      out.write("        <div class=\"category-search-container\">\r\n");
      out.write("            <div class=\"dropdown\">\r\n");
      out.write("                <button class=\"btn dropdown-toggle category-button\" type=\"button\" id=\"dropdownMenuButton\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\">\r\n");
      out.write("                    <span id=\"categoryText\">Kategori</span>\r\n");
      out.write("                </button>\r\n");
      out.write("                <ul class=\"dropdown-menu\" aria-labelledby=\"dropdownMenuButton\">\r\n");
      out.write("                    <li class=\"category-search-li\"> \r\n");
      out.write("                        <input class=\"form-control\" type=\"text\" placeholder=\"Cari Kategori...\" id=\"categorySearchInputInDropdown\">\r\n");
      out.write("                    </li>\r\n");
      out.write("                    <li><a class=\"dropdown-item\" href=\"books?category=Novel\">Novel</a></li>\r\n");
      out.write("                    <li><a class=\"dropdown-item\" href=\"books?category=Majalah\">Majalah</a></li>\r\n");
      out.write("                    <li><a class=\"dropdown-item\" href=\"books?category=Komik\">Komik</a></li>\r\n");
      out.write("                    <li><a class=\"dropdown-item\" href=\"books\">Semua Kategori</a></li>\r\n");
      out.write("                </ul>\r\n");
      out.write("            </div>\r\n");
      out.write("            <form class=\"form-inline flex-grow-1\" action=\"books\" method=\"get\"> \r\n");
      out.write("                <div class=\"search-input-group\">\r\n");
      out.write("                    <input class=\"form-control search-input\" type=\"search\" name=\"query\" placeholder=\"Mau cari apa hari ini?\" aria-label=\"Search\">\r\n");
      out.write("                    <button class=\"search-btn\" type=\"submit\">\r\n");
      out.write("                        <i class=\"bi bi-search\"></i>\r\n");
      out.write("                    </button>\r\n");
      out.write("                </div>\r\n");
      out.write("            </form>\r\n");
      out.write("        </div>\r\n");
      out.write("        <div class=\"user-menu\">\r\n");
      out.write("            <!-- Cart Button -->\r\n");
      out.write("            <a href=\"");
      out.print( isLoggedIn ? "cart" : "login.jsp" );
      out.write("\" class=\"text-white-icon me-3 position-relative\">\r\n");
      out.write("                <img src=\"assets/images/cart.png\" alt=\"cart\" class=\"cart-icon\">\r\n");
      out.write("                ");
 
                    Integer cartItemCount = (Integer) session.getAttribute("cartItemCount");
                    if (cartItemCount != null && cartItemCount > 0) {
                
      out.write("\r\n");
      out.write("                <span class=\"position-absolute top-0 start-100 translate-middle badge rounded-pill bg-dark\">\r\n");
      out.write("                    ");
      out.print( cartItemCount );
      out.write("\r\n");
      out.write("                </span>\r\n");
      out.write("                ");
 } 
      out.write("\r\n");
      out.write("            </a>\r\n");
      out.write("            <!-- User Menu Dropdown -->\r\n");
      out.write("            <div class=\"dropdown\">\r\n");
      out.write("                <a href=\"#\" class=\"dropdown-toggle\" id=\"userMenuDropdown\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\">\r\n");
      out.write("                    <img src=\"assets/images/profile.png\" alt=\"profile\" class=\"profile-icon\">\r\n");
      out.write("                </a>\r\n");
      out.write("                <ul class=\"dropdown-menu\" aria-labelledby=\"userMenuDropdown\">\r\n");
      out.write("                    ");
 if (isLoggedIn) { 
      out.write("\r\n");
      out.write("                        <li><h6 class=\"dropdown-header\">Halo, ");
      out.print( fullName );
      out.write("</h6></li>\r\n");
      out.write("                        <li><a class=\"dropdown-item\" href=\"profile.jsp\"><i class=\"bi bi-person-circle\"></i> Akun Saya</a></li>\r\n");
      out.write("                        <li><a class=\"dropdown-item\" href=\"profile.jsp#transaksi\"><i class=\"bi bi-receipt\"></i> Pesanan</a></li>\r\n");
      out.write("                        <li><hr class=\"dropdown-divider\"></li>\r\n");
      out.write("                        <li><a class=\"dropdown-item\" href=\"logout.jsp\"><i class=\"bi bi-box-arrow-right\"></i> Logout</a></li>\r\n");
      out.write("                    ");
 } else { 
      out.write("\r\n");
      out.write("                        <li><a class=\"dropdown-item\" href=\"login.jsp\"><i class=\"bi bi-box-arrow-in-right\"></i> Login</a></li>\r\n");
      out.write("                        <li><a class=\"dropdown-item\" href=\"register.jsp\"><i class=\"bi bi-person-plus-fill\"></i> Registrasi</a></li>\r\n");
      out.write("                    ");
 } 
      out.write("\r\n");
      out.write("                </ul>\r\n");
      out.write("            </div>\r\n");
      out.write("        </div>\r\n");
      out.write("    </nav>\r\n");
      out.write("</header>\r\n");
      out.write("\r\n");
      out.write("<main>\r\n");
      out.write("    <!-- Dynamic Banner Carousel -->\r\n");
      out.write("    <div id=\"AD\" class=\"carousel slide main-ad-carousel\" data-bs-ride=\"carousel\">\r\n");
      out.write("        <div class=\"carousel-inner\">\r\n");
      out.write("            ");
 
            if (activeBanners != null && !activeBanners.isEmpty()) {
                // Display dynamic banners from database (logika dari old)
                for (int i = 0; i < activeBanners.size(); i++) {
                    BannerSlide banner = activeBanners.get(i);
                    boolean isActive = i == 0;
            
      out.write("\r\n");
      out.write("            <div class=\"carousel-item ");
      out.print( isActive ? "active" : "" );
      out.write("\">\r\n");
      out.write("                <img src=\"");
      out.print( banner.getImagePath() != null ? banner.getImagePath() : "assets/images/default-banner.jpg" );
      out.write("\" \r\n");
      out.write("                     class=\"d-block carousel-img\" \r\n");
      out.write("                     alt=\"");
      out.print( banner.getTitle() != null ? banner.getTitle() : "Banner" );
      out.write("\">\r\n");
      out.write("                \r\n");
      out.write("                ");
 if (banner.getTitle() != null || banner.getDescription() != null || 
                       (banner.getLinkUrl() != null && !banner.getLinkUrl().trim().isEmpty())) { 
      out.write("\r\n");
      out.write("                ");
 } 
      out.write("\r\n");
      out.write("            </div>\r\n");
      out.write("            ");
 
                }
            } else {
                // Fallback to static banners if no dynamic banners available (logika dari old)
            
      out.write("\r\n");
      out.write("            <div class=\"carousel-item active\">\r\n");
      out.write("                <img src=\"assets/images/iklan_1.png\" class=\"d-block carousel-img\" alt=\"Promo Spesial\">\r\n");
      out.write("                <div class=\"banner-overlay d-flex align-items-center justify-content-center\">\r\n");
      out.write("                    <div class=\"text-center text-white\">\r\n");
      out.write("                        <h3 class=\"mb-3\">Selamat Datang di Mugiwara Library</h3>\r\n");
      out.write("                        <p class=\"mb-3\">Temukan koleksi buku terlengkap dengan harga terbaik!</p>\r\n");
      out.write("                        <a href=\"books\" class=\"btn btn-primary\">\r\n");
      out.write("                            <i class=\"bi bi-book me-2\"></i>Jelajahi Koleksi\r\n");
      out.write("                        </a>\r\n");
      out.write("                    </div>\r\n");
      out.write("                </div>\r\n");
      out.write("            </div>\r\n");
      out.write("            <div class=\"carousel-item\">\r\n");
      out.write("                <img src=\"assets/images/iklan_2.png\" class=\"d-block carousel-img\" alt=\"Diskon Besar\">\r\n");
      out.write("                <div class=\"banner-overlay d-flex align-items-center justify-content-center\">\r\n");
      out.write("                    <div class=\"text-center text-white\">\r\n");
      out.write("                        <h3 class=\"mb-3\">Diskon Hingga 50%</h3>\r\n");
      out.write("                        <p class=\"mb-3\">Dapatkan buku favorit Anda dengan harga spesial!</p>\r\n");
      out.write("                        <a href=\"books?action=bestseller\" class=\"btn btn-primary\">\r\n");
      out.write("                            <i class=\"bi bi-tag me-2\"></i>Lihat Promo\r\n");
      out.write("                        </a>\r\n");
      out.write("                    </div>\r\n");
      out.write("                </div>\r\n");
      out.write("            </div>\r\n");
      out.write("            <div class=\"carousel-item\">\r\n");
      out.write("                <img src=\"assets/images/iklan_3.png\" class=\"d-block carousel-img\" alt=\"Buku Terbaru\">\r\n");
      out.write("                <div class=\"banner-overlay d-flex align-items-center justify-content-center\">\r\n");
      out.write("                    <div class=\"text-center text-white\">\r\n");
      out.write("                        <h3 class=\"mb-3\">Koleksi Terbaru</h3>\r\n");
      out.write("                        <p class=\"mb-3\">Jangan lewatkan buku-buku terbaru yang telah tersedia!</p>\r\n");
      out.write("                        <a href=\"books?action=latest\" class=\"btn btn-primary\">\r\n");
      out.write("                            <i class=\"bi bi-star me-2\"></i>Lihat Terbaru\r\n");
      out.write("                        </a>\r\n");
      out.write("                    </div>\r\n");
      out.write("                </div>\r\n");
      out.write("            </div>\r\n");
      out.write("            <div class=\"carousel-item\">\r\n");
      out.write("                <img src=\"assets/images/iklan_4.png\" class=\"d-block carousel-img\" alt=\"Gratis Ongkir\">\r\n");
      out.write("                <div class=\"banner-overlay d-flex align-items-center justify-content-center\">\r\n");
      out.write("                    <div class=\"text-center text-white\">\r\n");
      out.write("                        <h3 class=\"mb-3\">Gratis Ongkos Kirim</h3>\r\n");
      out.write("                        <p class=\"mb-3\">Untuk pembelian minimal Rp 100.000</p>\r\n");
      out.write("                        <a href=\"books\" class=\"btn btn-primary\">\r\n");
      out.write("                            <i class=\"bi bi-truck me-2\"></i>Belanja Sekarang\r\n");
      out.write("                        </a>\r\n");
      out.write("                    </div>\r\n");
      out.write("                </div>\r\n");
      out.write("            </div>\r\n");
      out.write("            ");
 } 
      out.write("\r\n");
      out.write("        </div>\r\n");
      out.write("        \r\n");
      out.write("        <!-- Carousel Controls -->\r\n");
      out.write("        <button class=\"carousel-control-prev\" type=\"button\" data-bs-target=\"#AD\" data-bs-slide=\"prev\">\r\n");
      out.write("            <span class=\"carousel-control-prev-icon\" aria-hidden=\"true\"></span>\r\n");
      out.write("            <span class=\"visually-hidden\">Previous</span>\r\n");
      out.write("        </button>\r\n");
      out.write("        <button class=\"carousel-control-next\" type=\"button\" data-bs-target=\"#AD\" data-bs-slide=\"next\">\r\n");
      out.write("            <span class=\"carousel-control-next-icon\" aria-hidden=\"true\"></span>\r\n");
      out.write("            <span class=\"visually-hidden\">Next</span>\r\n");
      out.write("        </button>\r\n");
      out.write("        \r\n");
      out.write("        <!-- Carousel Indicators -->\r\n");
      out.write("        <div class=\"carousel-indicators\">\r\n");
      out.write("            ");
 
            int totalSlides = (activeBanners != null && !activeBanners.isEmpty()) ? activeBanners.size() : 4;
            for (int i = 0; i < totalSlides; i++) { 
            
      out.write("\r\n");
      out.write("            <button type=\"button\" data-bs-target=\"#AD\" data-bs-slide-to=\"");
      out.print( i );
      out.write("\" \r\n");
      out.write("                    ");
      out.print( i == 0 ? "class=\"active\" aria-current=\"true\"" : "" );
      out.write(" \r\n");
      out.write("                    aria-label=\"Slide ");
      out.print( i + 1 );
      out.write("\"></button>\r\n");
      out.write("            ");
 } 
      out.write("\r\n");
      out.write("        </div>\r\n");
      out.write("    </div>\r\n");
      out.write("    \r\n");
      out.write("    <!-- Latest Books Section -->\r\n");
      out.write("    <div class=\"section-header\">\r\n");
      out.write("        <h4>Buku Terbaru</h4>\r\n");
      out.write("        <p><a href=\"books?action=latest\">Lihat Semua</a></p>\r\n");
      out.write("    </div>\r\n");
      out.write("\r\n");
      out.write("    ");
 if (latestBooks.isEmpty()) { 
      out.write("\r\n");
      out.write("    <div class=\"text-center py-5\">\r\n");
      out.write("        <i class=\"bi bi-book text-muted\" style=\"font-size: 3rem;\"></i>\r\n");
      out.write("        <p class=\"text-muted mt-3\">Belum ada data buku terbaru</p>\r\n");
      out.write("    </div>\r\n");
      out.write("    ");
 } else { 
      out.write("\r\n");
      out.write("    <div id=\"terbaru\" class=\"carousel slide book-carousel-container book-terbaru-carousel\" data-bs-ride=\"carousel\">\r\n");
      out.write("        <div class=\"carousel-inner\">\r\n");
      out.write("            ");

                int latestBooksPerSlide = 6;
                int latestSlides = (int) Math.ceil((double) latestBooks.size() / latestBooksPerSlide);
                
                for (int slide = 0; slide < latestSlides; slide++) {
                    boolean isActive = slide == 0;
            
      out.write("\r\n");
      out.write("            <div class=\"carousel-item ");
      out.print( isActive ? "active" : "" );
      out.write("\">\r\n");
      out.write("                <div class=\"book-list\">\r\n");
      out.write("                    ");

                        int startIndex = slide * latestBooksPerSlide;
                        int endIndex = Math.min(startIndex + latestBooksPerSlide, latestBooks.size());
                        
                        for (int i = startIndex; i < endIndex; i++) {
                            Book book = latestBooks.get(i);
                            if (book != null) {
                    
      out.write("\r\n");
      out.write("                    <div class=\"book-card\">\r\n");
      out.write("                        <a href=\"books?action=detail&id=");
      out.print( book.getBook_id() );
      out.write("\" class=\"text-decoration-none\">\r\n");
      out.write("                            <img src=\"");
      out.print( book.getImagePath() != null ? book.getImagePath() : "default-book.jpg" );
      out.write("\" \r\n");
      out.write("                                 class=\"book-cover\" alt=\"");
      out.print( book.getTitle() != null ? book.getTitle() : "Unknown Title" );
      out.write("\">\r\n");
      out.write("                            <div class=\"book-body\">\r\n");
      out.write("                                <h6 class=\"book-author\">");
      out.print( book.getAuthor() != null && book.getAuthor().getName() != null ? book.getAuthor().getName() : "Unknown Author" );
      out.write("</h6>\r\n");
      out.write("                                <p class=\"book-title\">");
      out.print( book.getTitle() != null ? book.getTitle() : "Unknown Title" );
      out.write("</p>\r\n");
      out.write("                                <strong class=\"book-price\">Rp");
      out.print( String.format("%,d", book.getPrice()) );
      out.write("</strong>\r\n");
      out.write("                            </div>\r\n");
      out.write("                        </a>\r\n");
      out.write("                    </div>\r\n");
      out.write("                    ");
 
                            }
                        } 
                    
      out.write("\r\n");
      out.write("                </div>\r\n");
      out.write("            </div>\r\n");
      out.write("            ");
 } 
      out.write("\r\n");
      out.write("        </div>\r\n");
      out.write("        ");
 if (latestSlides > 1) { 
      out.write("\r\n");
      out.write("        <button class=\"carousel-control-prev\" type=\"button\" data-bs-target=\"#terbaru\" data-bs-slide=\"prev\">\r\n");
      out.write("            <span class=\"carousel-control-prev-icon\" aria-hidden=\"true\"></span>\r\n");
      out.write("            <span class=\"visually-hidden\">Previous</span>\r\n");
      out.write("        </button>\r\n");
      out.write("        <button class=\"carousel-control-next\" type=\"button\" data-bs-target=\"#terbaru\" data-bs-slide=\"next\">\r\n");
      out.write("            <span class=\"carousel-control-next-icon\" aria-hidden=\"true\"></span>\r\n");
      out.write("            <span class=\"visually-hidden\">Next</span>\r\n");
      out.write("        </button>\r\n");
      out.write("        <div class=\"carousel-indicators\">\r\n");
      out.write("            ");
 for (int i = 0; i < latestSlides; i++) { 
      out.write("\r\n");
      out.write("            <button type=\"button\" data-bs-target=\"#terbaru\" data-bs-slide-to=\"");
      out.print( i );
      out.write("\" \r\n");
      out.write("                    ");
      out.print( i == 0 ? "class=\"active\" aria-current=\"true\"" : "" );
      out.write(" aria-label=\"Slide ");
      out.print( i + 1 );
      out.write("\"></button>\r\n");
      out.write("            ");
 } 
      out.write("\r\n");
      out.write("        </div>\r\n");
      out.write("        ");
 } 
      out.write("\r\n");
      out.write("    </div>\r\n");
      out.write("    ");
 } 
      out.write("\r\n");
      out.write("\r\n");
      out.write("    <!-- Best Selling Books Section -->\r\n");
      out.write("    <div class=\"section-header\">\r\n");
      out.write("        <h4>Buku Terlaris</h4>\r\n");
      out.write("        <p><a href=\"books?action=bestseller\">Lihat Semua</a></p>\r\n");
      out.write("    </div>\r\n");
      out.write("\r\n");
      out.write("    ");
 if (bestSellingBooks.isEmpty()) { 
      out.write("\r\n");
      out.write("    <div class=\"text-center py-5\">\r\n");
      out.write("        <i class=\"bi bi-trophy text-muted\" style=\"font-size: 3rem;\"></i>\r\n");
      out.write("        <p class=\"text-muted mt-3\">Belum ada data buku terlaris</p>\r\n");
      out.write("    </div>\r\n");
      out.write("    ");
 } else { 
      out.write("\r\n");
      out.write("    <div id=\"terlaris\" class=\"carousel slide book-carousel-container book-terlaris-carousel\" data-bs-ride=\"carousel\">\r\n");
      out.write("        <div class=\"carousel-inner\">\r\n");
      out.write("            ");

                int bestSellingBooksPerSlide = 6;
                int bestSellingSlides = (int) Math.ceil((double) bestSellingBooks.size() / bestSellingBooksPerSlide);
                
                for (int slide = 0; slide < bestSellingSlides; slide++) {
                    boolean isActive = slide == 0;
            
      out.write("\r\n");
      out.write("            <div class=\"carousel-item ");
      out.print( isActive ? "active" : "" );
      out.write("\">\r\n");
      out.write("                <div class=\"book-list\">\r\n");
      out.write("                    ");

                        int startIndex = slide * bestSellingBooksPerSlide;
                        int endIndex = Math.min(startIndex + bestSellingBooksPerSlide, bestSellingBooks.size());
                        
                        for (int i = startIndex; i < endIndex; i++) {
                            Book book = bestSellingBooks.get(i);
                            if (book != null) {
                    
      out.write("\r\n");
      out.write("                    <div class=\"book-card\">\r\n");
      out.write("                        <a href=\"books?action=detail&id=");
      out.print( book.getBook_id() );
      out.write("\" class=\"text-decoration-none\">\r\n");
      out.write("                            <!-- Menggunakan default image path dari old -->\r\n");
      out.write("                            <img src=\"");
      out.print( book.getImagePath() != null ? book.getImagePath() : "default-book.jpg" );
      out.write("\" \r\n");
      out.write("                                 class=\"book-cover\" alt=\"");
      out.print( book.getTitle() != null ? book.getTitle() : "Unknown Title" );
      out.write("\">\r\n");
      out.write("                            <div class=\"book-body\">\r\n");
      out.write("                                <h6 class=\"book-author\">");
      out.print( book.getAuthor() != null && book.getAuthor().getName() != null ? book.getAuthor().getName() : "Unknown Author" );
      out.write("</h6>\r\n");
      out.write("                                <p class=\"book-title\">");
      out.print( book.getTitle() != null ? book.getTitle() : "Unknown Title" );
      out.write("</p>\r\n");
      out.write("                                <strong class=\"book-price\">Rp");
      out.print( String.format("%,d", book.getPrice()) );
      out.write("</strong>\r\n");
      out.write("                            </div>\r\n");
      out.write("                        </a>\r\n");
      out.write("                    </div>\r\n");
      out.write("                    ");
 
                            }
                        } 
                    
      out.write("\r\n");
      out.write("                </div>\r\n");
      out.write("            </div>\r\n");
      out.write("            ");
 } 
      out.write("\r\n");
      out.write("        </div>\r\n");
      out.write("        ");
 if (bestSellingSlides > 1) { 
      out.write("\r\n");
      out.write("        <button class=\"carousel-control-prev\" type=\"button\" data-bs-target=\"#terlaris\" data-bs-slide=\"prev\">\r\n");
      out.write("            <span class=\"carousel-control-prev-icon\" aria-hidden=\"true\"></span>\r\n");
      out.write("            <span class=\"visually-hidden\">Previous</span>\r\n");
      out.write("        </button>\r\n");
      out.write("        <button class=\"carousel-control-next\" type=\"button\" data-bs-target=\"#terlaris\" data-bs-slide=\"next\">\r\n");
      out.write("            <span class=\"carousel-control-next-icon\" aria-hidden=\"true\"></span>\r\n");
      out.write("            <span class=\"visually-hidden\">Next</span>\r\n");
      out.write("        </button>\r\n");
      out.write("        <div class=\"carousel-indicators\">\r\n");
      out.write("            ");
 for (int i = 0; i < bestSellingSlides; i++) { 
      out.write("\r\n");
      out.write("            <button type=\"button\" data-bs-target=\"#terlaris\" data-bs-slide-to=\"");
      out.print( i );
      out.write("\" \r\n");
      out.write("                    ");
      out.print( i == 0 ? "class=\"active\" aria-current=\"true\"" : "" );
      out.write(" aria-label=\"Slide ");
      out.print( i + 1 );
      out.write("\"></button>\r\n");
      out.write("            ");
 } 
      out.write("\r\n");
      out.write("        </div>\r\n");
      out.write("        ");
 } 
      out.write("\r\n");
      out.write("    </div>\r\n");
      out.write("    ");
 } 
      out.write("\r\n");
      out.write("    \r\n");
      out.write("    <!-- Customer Testimonials Section -->\r\n");
      out.write("    <div class=\"container d-flex justify-content-center\">\r\n");
      out.write("        <div class=\"testimonials-section\">\r\n");
      out.write("            <h4 class=\"text-center pt-4 mb-4\">Apa Kata Customer</h4>\r\n");
      out.write("\r\n");
      out.write("            ");
 if (customerReviews.isEmpty()) { 
      out.write("\r\n");
      out.write("            <div class=\"text-center py-5\">\r\n");
      out.write("                <i class=\"bi bi-chat-quote text-muted\" style=\"font-size: 3rem;\"></i>\r\n");
      out.write("                <p class=\"text-muted mt-3\">Belum ada review dari customer</p>\r\n");
      out.write("            </div>\r\n");
      out.write("            ");
 } else { 
      out.write("\r\n");
      out.write("            <div id=\"customerTestimonials\" class=\"carousel slide testimonial-carousel-container testimonial-carousel\" data-bs-ride=\"carousel\">\r\n");
      out.write("                <div class=\"carousel-inner\">\r\n");
      out.write("                    ");

                        int reviewsPerSlide = 3;
                        int reviewSlides = Math.max(1, (int) Math.ceil((double) customerReviews.size() / reviewsPerSlide));
                        
                        for (int slide = 0; slide < reviewSlides; slide++) {
                            boolean isActive = slide == 0;
                    
      out.write("\r\n");
      out.write("                    <div class=\"carousel-item ");
      out.print( isActive ? "active" : "" );
      out.write("\">\r\n");
      out.write("                        <div class=\"testimonials-wrapper\">\r\n");
      out.write("                            ");

                                int startIndex = slide * reviewsPerSlide;
                                int endIndex = Math.min(startIndex + reviewsPerSlide, customerReviews.size());
                                
                                for (int i = startIndex; i < endIndex; i++) {
                                    Review review = customerReviews.get(i);
                                    if (review != null) {
                            
      out.write("\r\n");
      out.write("                            <div class=\"testimonial-card\">\r\n");
      out.write("                                <div class=\"card-body\">\r\n");
      out.write("                                    <p class=\"card-text\">\"");
      out.print( review.getComment() != null && !review.getComment().trim().isEmpty() ? review.getComment() : "Pelayanan yang sangat memuaskan!" );
      out.write("\"</p>\r\n");
      out.write("                                    <div class=\"star-rating\">\r\n");
      out.write("                                        <span>\r\n");
      out.write("                                            ");

                                                int rating = review.getRating();
                                                for (int star = 1; star <= 5; star++) {
                                                    if (star <= rating) {
                                                        out.print("★");
                                                    } else {
                                                        out.print("☆");
                                                    }
                                                }
                                            
      out.write("\r\n");
      out.write("                                        </span>\r\n");
      out.write("                                    </div>\r\n");
      out.write("                                    <h5>");
      out.print( review.getUser() != null && review.getUser().getFullName() != null ? review.getUser().getFullName() : "Customer" );
      out.write("</h5>\r\n");
      out.write("                                    ");
 if (review.getBook() != null && review.getBook().getTitle() != null) { 
      out.write("\r\n");
      out.write("                                    <small class=\"text-muted\">Review untuk: ");
      out.print( review.getBook().getTitle() );
      out.write("</small>\r\n");
      out.write("                                    ");
 } 
      out.write("\r\n");
      out.write("                                </div>\r\n");
      out.write("                            </div>\r\n");
      out.write("                            ");
 
                                    } else {
                                        // Fallback testimonial if review is null (logika dari old)
                            
      out.write("\r\n");
      out.write("                            <div class=\"testimonial-card\">\r\n");
      out.write("                                <div class=\"card-body\">\r\n");
      out.write("                                    <p class=\"card-text\">\"Terima kasih Mugiwara Library atas pelayanan yang memuaskan!\"</p>\r\n");
      out.write("                                    <div class=\"star-rating\">\r\n");
      out.write("                                        <span>★★★★★</span>\r\n");
      out.write("                                    </div>\r\n");
      out.write("                                    <h5>Customer</h5>\r\n");
      out.write("                                </div>\r\n");
      out.write("                            </div>\r\n");
      out.write("                            ");

                                    }
                                }
                                
                                // Fill empty slots if needed to maintain layout (logika dari old)
                                for (int i = endIndex; i < startIndex + reviewsPerSlide; i++) { 
                            
      out.write("\r\n");
      out.write("                            <div class=\"testimonial-card\">\r\n");
      out.write("                                <div class=\"card-body\">\r\n");
      out.write("                                    <p class=\"card-text\">\"Koleksi buku yang lengkap dan pelayanan yang ramah!\"</p>\r\n");
      out.write("                                    <div class=\"star-rating\">\r\n");
      out.write("                                        <span>★★★★★</span>\r\n");
      out.write("                                    </div>\r\n");
      out.write("                                    <h5>Customer</h5>\r\n");
      out.write("                                </div>\r\n");
      out.write("                            </div>\r\n");
      out.write("                            ");
 } 
      out.write("\r\n");
      out.write("                        </div>\r\n");
      out.write("                    </div>\r\n");
      out.write("                    ");
 } 
      out.write("\r\n");
      out.write("                </div>\r\n");
      out.write("                ");
 if (reviewSlides > 1) { 
      out.write("\r\n");
      out.write("                <button class=\"carousel-control-prev\" type=\"button\" data-bs-target=\"#customerTestimonials\" data-bs-slide=\"prev\">\r\n");
      out.write("                    <span class=\"carousel-control-prev-icon\" aria-hidden=\"true\"></span>\r\n");
      out.write("                    <span class=\"visually-hidden\">Previous</span>\r\n");
      out.write("                </button>\r\n");
      out.write("                <button class=\"carousel-control-next\" type=\"button\" data-bs-target=\"#customerTestimonials\" data-bs-slide=\"next\">\r\n");
      out.write("                    <span class=\"carousel-control-next-icon\" aria-hidden=\"true\"></span>\r\n");
      out.write("                    <span class=\"visually-hidden\">Next</span>\r\n");
      out.write("                </button>\r\n");
      out.write("                <div class=\"testimonial-indicators carousel-indicators\">\r\n");
      out.write("                    ");
 for (int i = 0; i < reviewSlides; i++) { 
      out.write("\r\n");
      out.write("                    <button type=\"button\" data-bs-target=\"#customerTestimonials\" data-bs-slide-to=\"");
      out.print( i );
      out.write("\" \r\n");
      out.write("                            ");
      out.print( i == 0 ? "class=\"active\" aria-current=\"true\"" : "" );
      out.write(" aria-label=\"Slide ");
      out.print( i + 1 );
      out.write("\"></button>\r\n");
      out.write("                    ");
 } 
      out.write("\r\n");
      out.write("                </div>\r\n");
      out.write("                ");
 } 
      out.write("\r\n");
      out.write("            </div>\r\n");
      out.write("            ");
 } 
      out.write("\r\n");
      out.write("            \r\n");
      out.write("            <div class=\"testimonials-action\">\r\n");
      out.write("                <!-- Menggunakan link dari old yang mengarah ke \"reviews\" -->\r\n");
      out.write("                <a href=\"reviews\" class=\"btn-custom-lainnya\">\r\n");
      out.write("                    Lainnya\r\n");
      out.write("                </a>\r\n");
      out.write("            </div>\r\n");
      out.write("        </div>\r\n");
      out.write("    </div>\r\n");
      out.write("</main>\r\n");
      out.write("\r\n");
      out.write("<!-- Footer -->\r\n");
      out.write("<footer>\r\n");
      out.write("    <p>&copy; 2025 Isekai Byte - Mugiwara Library. All rights reserved.</p>\r\n");
      out.write("</footer>\r\n");
      out.write("\r\n");
      out.write("<!-- Scripts (struktur dari old) -->\r\n");
      out.write("<script>\r\n");
      out.write("    document.addEventListener('DOMContentLoaded', function () {\r\n");
      out.write("        const categorySearchInput = document.getElementById(\"categorySearchInputInDropdown\");\r\n");
      out.write("        if (categorySearchInput) {\r\n");
      out.write("            const dropdownMenu = categorySearchInput.closest('.dropdown-menu');\r\n");
      out.write("            const itemsToFilter = dropdownMenu.querySelectorAll(\"li:not(.category-search-li) a.dropdown-item\");\r\n");
      out.write("            \r\n");
      out.write("            categorySearchInput.addEventListener(\"keyup\", function() {\r\n");
      out.write("                let filter = this.value.toLowerCase();\r\n");
      out.write("                \r\n");
      out.write("                itemsToFilter.forEach(function(itemLink) {\r\n");
      out.write("                    let text = itemLink.textContent.toLowerCase();\r\n");
      out.write("                    let listItem = itemLink.parentElement;\r\n");
      out.write("                    if (text.includes(filter)) {\r\n");
      out.write("                        listItem.style.display = \"\";\r\n");
      out.write("                    } else {\r\n");
      out.write("                        listItem.style.display = \"none\";\r\n");
      out.write("                    }\r\n");
      out.write("                });\r\n");
      out.write("            });\r\n");
      out.write("            \r\n");
      out.write("            categorySearchInput.addEventListener('click', function (e) {\r\n");
      out.write("                e.stopPropagation();\r\n");
      out.write("            });\r\n");
      out.write("        }\r\n");
      out.write("\r\n");
      out.write("        const categoryItems = document.querySelectorAll('.dropdown-item[href*=\"category\"]');\r\n");
      out.write("        const categoryText = document.getElementById('categoryText');\r\n");
      out.write("        const categoryButton = document.getElementById('dropdownMenuButton');\r\n");
      out.write("        \r\n");
      out.write("        categoryItems.forEach(item => {\r\n");
      out.write("            item.addEventListener('click', function(e) {\r\n");
      out.write("                const selectedCategory = this.textContent.trim();\r\n");
      out.write("                categoryText.textContent = selectedCategory;\r\n");
      out.write("                categoryButton.classList.add('selected');\r\n");
      out.write("            });\r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("        const bannerCarousel = document.getElementById('AD');\r\n");
      out.write("        if (bannerCarousel) {\r\n");
      out.write("            const carousel = new bootstrap.Carousel(bannerCarousel, {\r\n");
      out.write("                interval: 5000, \r\n");
      out.write("                wrap: true\r\n");
      out.write("            });\r\n");
      out.write("\r\n");
      out.write("            // Pause on hover\r\n");
      out.write("            bannerCarousel.addEventListener('mouseenter', function() {\r\n");
      out.write("                carousel.pause();\r\n");
      out.write("            });\r\n");
      out.write("\r\n");
      out.write("            // Resume on mouse leave\r\n");
      out.write("            bannerCarousel.addEventListener('mouseleave', function() {\r\n");
      out.write("                carousel.cycle();\r\n");
      out.write("            });\r\n");
      out.write("        }\r\n");
      out.write("\r\n");
      out.write("        const bookCarousels = document.querySelectorAll('.book-carousel-container .carousel');\r\n");
      out.write("        bookCarousels.forEach(carousel => {\r\n");
      out.write("            new bootstrap.Carousel(carousel, {\r\n");
      out.write("                interval: 8000,\r\n");
      out.write("                wrap: true\r\n");
      out.write("            });\r\n");
      out.write("        });\r\n");
      out.write("        \r\n");
      out.write("        const testimonialCarousel = document.getElementById('customerTestimonials');\r\n");
      out.write("        if (testimonialCarousel) {\r\n");
      out.write("            new bootstrap.Carousel(testimonialCarousel, {\r\n");
      out.write("                interval: 6000,\r\n");
      out.write("                wrap: true\r\n");
      out.write("            });\r\n");
      out.write("        }\r\n");
      out.write("    });\r\n");
      out.write("</script>\r\n");
      out.write("</body>\r\n");
      out.write("</html>");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try {
            if (response.isCommitted()) {
              out.flush();
            } else {
              out.clearBuffer();
            }
          } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
